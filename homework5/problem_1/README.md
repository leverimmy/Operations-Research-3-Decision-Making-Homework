# Problem 1

## 配置环境

首先，新建虚拟环境：

```bash
python3 -m venv .venv
```

然后，激活虚拟环境。在 Windows 下，使用如下命令：

```bash
.venv\Scripts\activate
```

在 Linux 或者 macOS 下，使用如下命令：

```bash
source .venv/bin/activate
```

进入虚拟环境后，安装依赖：

```bash
pip install -r requirements.txt
```

## 问题回答

### (1)

设 $\omega = (d_d, d_t, d_c) \in \Omega$，则 $\Omega$ 中元素及其概率如下表所示：

| $\omega$ | $p_\omega$ | $\omega$ | $p_\omega$ | $\omega$ | $p_\omega$ |
|:-:|:-:|:-:|:-:|:-:|:-:|
| $(95, 40, 140)$ | $0.0225$ | $(95, 40, 210)$ | $0.0375$ | $(95, 40, 365)$ | $0.045$ |
| $(95, 40, 390)$ | $0.045$ | $(95, 150, 140)$ | $0.045$ | $(95, 150, 210)$ | $0.075$ |
| $(95, 150, 365)$ | $0.09$ | $(95, 150, 390)$ | $0.09$ | $(95, 230, 140)$ | $0.0075$ |
| $(95, 230, 210)$ | $0.0125$ | $(95, 230, 365)$ | $0.015$ | $(95, 230, 390)$ | $0.015$ |
| $(190, 40, 140)$ | $0.018$ | $(190, 40, 210)$ | $0.03$ | $(190, 40, 365)$ | $0.036$ |
| $(190, 40, 390)$ | $0.036$ | $(190, 150, 140)$ | $0.036$ | $(190, 150, 210)$ | $0.06$ |
| $(190, 150, 365)$ | $0.072$ | $(190, 150, 390)$ | $0.072$ | $(190, 230, 140)$ | $0.006$ |
| $(190, 230, 210)$ | $0.01$ | $(190, 230, 365)$ | $0.012$ | $(190, 230, 390)$ | $0.012$ |
| $(265, 40, 140)$ | $0.0045$ | $(265, 40, 210)$ | $0.0075$ | $(265, 40, 365)$ | $0.009$ |
| $(265, 40, 390)$ | $0.009$ | $(265, 150, 140)$ | $0.009$ | $(265, 150, 210)$ | $0.015$ |
| $(265, 150, 365)$ | $0.018$ | $(265, 150, 390)$ | $0.018$ | $(265, 230, 140)$ | $0.0015$ |
| $(265, 230, 210)$ | $0.0025$ | $(265, 230, 365)$ | $0.003$ | $(265, 230, 390)$ | $0.003$ | 

### (2)

计算 Desk、Table、Chair 的平均需求如下：

$$
\begin{align*}
\bar{d_d} & = 95 \times 0.5 + 190 \times 0.4 + 265 \times 0.1 = 150, \\
\bar{d_t} & = 40 \times 0.3 + 150 \times 0.6 + 230 \times 0.1 = 125, \\
\bar{d_c} & = 140 \times 0.15 + 210 \times 0.25 + 365 \times 0.3 + 390 \times 0.3 = 300.
\end{align*}
$$

设 $x_l, x_f, x_c$ 分别表示 Lumber、Finishing、Carpentry 的进货量，$y_d, y_t, y_c$ 分别表示 Desk、Table、Chair 的生产量，$s_d, s_t, s_c$ 分别表示 Desk、Table、Chair 的售卖量，则有

$$
\begin{align*}
\max \quad & -2x_l - 4x_f - 5.2x_c + 60s_d + 40s_t + 10s_c \\
\text{s.t.} \quad & -x_l + 8y_d + 6y_c + y_c \le 0, \\
& -x_f + 4y_d + 2y_t + 1.5y_c \le 0, \\
& -x_c + 2y_d + 1.5y_t + 0.5y_c \le 0, \\
& s_d \le 150, \\
& -y_d + s_d \le 0, \\
& s_t \le 125, \\
& -y_t + s_t \le 0, \\
& s_c \le 300, \\
& -y_c + s_c \le 0, \\
& x_l, x_f, x_c, y_d, y_t, y_c, s_d, s_t, s_c \ge 0.
\end{align*}
$$

运行

```bash
python3 main.py --task=2
```

输出为

```bash
x_l: 1950.0
x_f: 850.0
x_c: 487.5
y_d: 150.0
y_t: 125.0
y_c: 0.0
s_d: 150.0
s_t: 125.0
s_c: 0.0
Maximum Profit: 4165.0
```

由输出可知，此时最佳方案为

$$
(x_l, x_f, x_c) = (1950, 850, 487.5),
$$

能够获得利润 $4165$ 美元。

### (3)

假设解决的是 $\omega = (95, 40, 140)$ 这个 scenario，则

设 $x_l, x_f, x_c$ 分别表示 Lumber、Finishing、Carpentry 的进货量，$y_d, y_t, y_c$ 分别表示 Desk、Table、Chair 的生产量，$s_d, s_t, s_c$ 分别表示 Desk、Table、Chair 的售卖量，则有

$$
\begin{align*}
\max \quad & -2x_l - 4x_f - 5.2x_c + 60s_d + 40s_t + 10s_c \\
\text{s.t.} \quad & -x_l + 8y_d + 6y_c + y_c \le 0, \\
& -x_f + 4y_d + 2y_t + 1.5y_c \le 0, \\
& -x_c + 2y_d + 1.5y_t + 0.5y_c \le 0, \\
& s_d \le 95, \\
& -y_d + s_d \le 0, \\
& s_t \le 40, \\
& -y_t + s_t \le 0, \\
& s_c \le 135, \\
& -y_c + s_c \le 0, \\
& x_l, x_f, x_c, y_d, y_t, y_c, s_d, s_t, s_c \ge 0.
\end{align*}
$$

运行

```bash
python3 main.py --task=3
```

输出为

```bash
x_l: 1000.0
x_f: 460.0
x_c: 250.0
y_d: 95.0
y_t: 40.0
y_c: 0.0
s_d: 95.0
s_t: 40.0
s_c: 0.0
Maximum Profit: 2160.0
```

由输出可知，此时最佳方案为

$$
(x_l, x_f, x_c) = (1000, 460, 250),
$$

能够获得利润 $2160$ 美元。

### (4)

设 $\omega = (d_d, d_t, d_c) \in \Omega$，设 $x_l, x_f, x_c$ 分别表示 Lumber、Finishing、Carpentry 的进货量，$y_d(\omega), y_t(\omega), y_c(\omega)$ 分别表示在 $\omega$ 情形下的 Desk、Table、Chair 的生产量，则有

$$
\begin{align*}
\max \quad & -2x_l - 4x_f - 5.2x_c + \mathbb{E}\left[60y_d(\omega) + 40y_t(\omega) + 10y_c(\omega)\right] \\
\text{s.t.} \quad & y_d(\omega) \le \tilde{d_d}(\omega), \\
& y_t(\omega) \le \tilde{d_t}(\omega), \\
& y_c(\omega) \le \tilde{d_c}(\omega), \\
& -x_l + 8y_d(\omega) + 6y_c(\omega) + y_c(\omega) \le 0, \\
& -x_f + 4y_d(\omega) + 2y_t(\omega) + 1.5y_c(\omega) \le 0, \\
& -x_c + 2y_d(\omega) + 1.5y_t(\omega) + 0.5y_c(\omega) \le 0, \\
& x_l, x_f, x_c, y_d(\omega), y_t(\omega), y_c(\omega) \ge 0, \\
& \forall \omega \in \Omega.
\end{align*}
$$

运行

```bash
python3 main.py --task=4
```

输出为

```bash
x_l: 1768.5714285714287
x_f: 842.8571428571429
x_c: 469.28571428571433
y_d_0: 95.0
y_d_1: 95.0
y_d_2: 95.0
y_d_3: 95.0
y_d_4: 95.0
y_d_5: 95.0
y_d_6: 95.0
y_d_7: 95.0
y_d_8: 95.0
y_d_9: 95.0
y_d_10: 95.0
y_d_11: 95.0
y_d_12: 190.0
y_d_13: 190.0
y_d_14: 190.0
y_d_15: 190.0
y_d_16: 190.0
y_d_17: 190.0
y_d_18: 190.0
y_d_19: 190.0
y_d_20: 190.0
y_d_21: 190.0
y_d_22: 190.0
y_d_23: 190.0
y_d_24: 190.71428571428572
y_d_25: 190.71428571428572
y_d_26: 190.71428571428572
y_d_27: 190.71428571428572
y_d_28: 190.0
y_d_29: 190.0
y_d_30: 190.0
y_d_31: 190.0
y_d_32: 190.0
y_d_33: 190.0
y_d_34: 190.0
y_d_35: 190.0
y_t_0: 40.0
y_t_1: 40.0
y_t_2: 40.0
y_t_3: 40.0
y_t_4: 150.0
y_t_5: 150.0
y_t_6: 150.0
y_t_7: 150.0
y_t_8: 150.0
y_t_9: 150.0
y_t_10: 150.00000000000003
y_t_11: 150.0
y_t_12: 40.0
y_t_13: 40.0
y_t_14: 40.0
y_t_15: 40.0
y_t_16: 41.428571428571445
y_t_17: 41.428571428571445
y_t_18: 41.428571428571445
y_t_19: 41.428571428571445
y_t_20: 41.428571428571445
y_t_21: 41.428571428571445
y_t_22: 41.428571428571445
y_t_23: 41.42857142857143
y_t_24: 40.0
y_t_25: 40.0
y_t_26: 40.0
y_t_27: 40.0
y_t_28: 41.428571428571445
y_t_29: 41.428571428571445
y_t_30: 41.428571428571445
y_t_31: 41.428571428571445
y_t_32: 41.428571428571445
y_t_33: 41.428571428571445
y_t_34: 41.428571428571445
y_t_35: 41.428571428571445
y_c_0: 140.0
y_c_1: 210.0
y_c_2: 255.23809523809527
y_c_3: 255.23809523809527
y_c_4: 108.5714285714286
y_c_5: 108.57142857142867
y_c_6: 108.57142857142867
y_c_7: 108.5714285714286
y_c_8: 108.57142857142863
y_c_9: 108.57142857142867
y_c_10: 108.57142857142856
y_c_11: 108.5714285714286
y_c_12: 1.9047619047619264
y_c_13: 1.9047619047619264
y_c_14: 1.9047619047619264
y_c_15: 1.9047619047619264
y_c_16: 0.0
y_c_17: 0.0
y_c_18: 0.0
y_c_19: 0.0
y_c_20: 0.0
y_c_21: 0.0
y_c_22: 0.0
y_c_23: 0.0
y_c_24: 0.0
y_c_25: 0.0
y_c_26: 0.0
y_c_27: 0.0
y_c_28: 0.0
y_c_29: 0.0
y_c_30: 0.0
y_c_31: 0.0
y_c_32: 0.0
y_c_33: 0.0
y_c_34: 0.0
y_c_35: 0.0
Maximum Profit: 3084.6785714285675
```

由输出可知，此时最佳方案为

$$
(x_l, x_f, x_c) = (1768.57, 842.86, 469.29),
$$

能够获得利润 $3084.68$ 美元。

### (5)

运行

```bash
python3 main.py --task=5
```

输出为

```bash
Evaluation of MVP:      2998.4166666666665
Evaluation of Scenario: 2160.0000000000005
Evaluation of DEP:      3084.6785714285706
```

由输出可知，三种解在随机的情形下分别能获得利润（单位：美元）如下表所示：

| MVP | (3) 中的 scenario | DEP |
|:-:|:-:|:-:|
| $2998.42$ | $2160$ | $3084.68$ |

### (6)

对于每一个 $\omega \in \Omega$，都进行一遍 evaluation，并求出期望 $\mathbb{E}[\hat{f}_\omega(\hat{x}_\omega)]$。

运行

```bash
python3 main.py --task=6
```

输出为

```bash
Evaluation:     4165.0
```

- 由输出可知 $\mathbb{E}[\hat{f}_\omega(\hat{x}_\omega)] = 4165$，
- 由 (4) 知 $f(x^*) = 3084.68$，
- 由 (5) 知 $f(\bar{x}) = 2998.42$。

因此，

$$
\begin{align*}
\text{EVPI} & = \mathbb{E}[\hat{f}_\omega(\hat{x}_\omega)] - f(x^*) \\
& = 4165 - 3084.68 \\
& = 1080.32, \\
\text{VSS} & = f(x^*) - f(\bar{x}) \\
& = 3084.68 - 2998.42 \\
& = 86.26.
\end{align*}
$$
