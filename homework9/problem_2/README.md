# Problem 2

## (a)

### State

Planning Horizon 为 $T = 3$。设 $S_t(1 \le t \le T)$ 表示在 District $t$ 做决策之前，还剩下 $S_t$ 个 sales representatives 可供分配。

### Decision

设 $x_t$ 表示给 District $t$ 分配 $x_t$ 个 sales representatives。约束条件是 $0 \le x_t \le \min\{S_t, 3\}$。

### Exogenous Information

在这个问题中，没有局部的 exogenous information，也就是说，在两个 state 之间转移的时候，是没有新的外部信息的——只有在所有决策做完后，才能知道 current year 的 economy 是 good year 还是 bad year。将这个 information 记作 $W_{\text{econ}}$。

### Transition Function

转移函数为

$$
S_{t + 1} = S_t - x_t
$$

### One-period Contribution Function

将表格中的信息记作 $\text{Sales}_t(x_t, \text{Bad})$ 和 $\text{Sales}(x_t, \text{Good})$。单步决策的 reward 为

$$
r_t(x_t) = P(W_{\text{econ}} = \text{Bad}) \cdot \text{Sales}_t(x_t, \text{Bad}) + P(W_{\text{econ}} = \text{Good}) \cdot \text{Sales}_t(x_t, \text{Good})
$$

### Objective Function

Value Function 为

$$
V_t(S_t) = \max_{0 \le x_t \le \min\{S_t, 3\}}\{r_t(x_t) + V_{t + 1}(S_{t + 1})\},
$$

边界条件为 $V_T(S_T) = \max_{0 \le x_T \le \min\{S_T, 3\}}\{r_T(S_T)\}$。Objective Function 即为 $V_1(5)$。

## (b)

首先计算出 $r_t(x_t)$ 的表格：

| $r_t(x_t)$ | $x_t = 0$ | $x_t = 1$ | $x_t = 2$ | $x_t = 3$ |
|:----------:|:---------:|:---------:|:---------:|:---------:|
| $t = 1$    |   $1.9$   |   $3.2$   |   $4.2$   |   $5.2$   |
| $t = 2$    |   $2.9$   |   $4.6$   |   $5.3$   |   $6.0$   |
| $t = 3$    |   $3.3$   |   $5.0$   |   $6.3$   |   $7.0$   |

然后按照 Value Function 倒推：

**District $3$**

$$
\begin{align*}
    V_3(0) & = r_3(0) = 3.3, \\
    V_3(1) & = \max\{r_3(0), r_3(1)\} \\
        & = \max\{3.3, 5.0\} = 5.0, \\
    V_3(2) & = \max\{r_3(0), r_3(1), r_3(2)\} \\
        & = \max\{3.3, 5.0, 6.3\} = 6.3, \\
    V_3(3) & = \max\{r_3(0), r_3(1), r_3(2), r_3(3)\} \\
        & = \max\{3.3, 5.0, 6.3, 7.0\} = 7.0, \\
    V_3(4) & = \max\{r_3(0), r_3(1), r_3(2), r_3(3)\} \\
        & = \max\{3.3, 5.0, 6.3, 7.0\} = 7.0, \\
    V_3(5) & = \max\{r_3(0), r_3(1), r_3(2), r_3(3)\} \\
        & = \max\{3.3, 5.0, 6.3, 7.0\} = 7.0.
\end{align*}
$$

对应的最优解 $x_3^*(S_3)$：

$$
\begin{align*}
    x_3^*(0) & = 0, \\
    x_3^*(1) & = 1, \\
    x_3^*(2) & = 2, \\
    x_3^*(3) & = 3, \\
    x_3^*(4) & = 3, \\
    x_3^*(5) & = 3.
\end{align*}
$$

**District $2$**

在有多个最优决策时，我们选择较小的作为 $x_2^*$。

$$
\begin{align*}
    V_2(0) & = r_2(0) + V_3(0) = 2.9 + 3.3 = 6.2, \\
    V_2(1) & = \max\{r_2(0) + V_3(1), r_2(1) + V_3(0)\} \\
        & = \max\{2.9 + 5.0, 4.6 + 3.3\} \\
        & = \max\{7.9, 7.9\} = 7.9, \\
    V_2(2) & = \max\{r_2(0) + V_3(2), r_2(1) + V_3(1), r_2(2) + V_3(0)\} \\
        & = \max\{2.9 + 6.3, 4.6 + 5.0, 5.3 + 3.3\} \\
        & = \max\{9.2, 9.6, 8.6\} = 9.6, \\
    V_2(3) & = \max\{r_2(0) + V_3(3), r_2(1) + V_3(2), r_2(2) + V_3(1), r_2(3) + V_3(0)\} \\
        & = \max\{2.9 + 7.0, 4.6 + 6.3, 5.3 + 5.0, 6.0 + 3.3\} \\
        & = \max\{9.9, 10.9, 10.3, 9.3\} = 10.9, \\
    V_2(4) & = \max\{r_2(0) + V_3(4), r_2(1) + V_3(3), r_2(2) + V_3(2), r_2(3) + V_3(1)\} \\
        & = \max\{2.9 + 7.0, 4.6 + 7.0, 5.3 + 6.3, 6.0 + 5.0\} \\
        & = \max\{9.9, 11.6, 11.6, 11.0\} = 11.6, \\
    V_2(5) & = \max\{r_2(0) + V_3(5), r_2(1) + V_3(4), r_2(2) + V_3(3), r_2(3) + V_3(2)\} \\
        & = \max\{2.9 + 7.0, 4.6 + 7.0, 5.3 + 7.0, 6.0 + 6.3\} \\
        & = \max\{9.9, 11.6, 12.3, 12.3\} = 12.3.
\end{align*}
$$

对应的最优解 $x_2^*(S_2)$：

$$
\begin{align*}
    x_2^*(0) & = 0, \\
    x_2^*(1) & = 0, \\
    x_2^*(2) & = 1, \\
    x_2^*(3) & = 1, \\
    x_2^*(4) & = 1, \\
    x_2^*(5) & = 2.
\end{align*}
$$

**District $1$**

$$
\begin{align*}
    V_1(5) & = \max\{r_1(0) + V_2(5), r_1(1) + V_2(4), r_1(2) + V_2(3), r_1(3) + V_2(2)\} \\
        & = \max\{1.9 + 12.3, 3.2 + 11.6, 4.2 + 10.9, 5.2 + 9.6\} \\
        & = \max\{14.2, 14.8, 15.1, 14.8\} = 15.1.
\end{align*}
$$

对应的最优解 $x_1^*(5)$：

$$
\begin{align*}
    x_1^*(5) & = 2.
\end{align*}
$$

**总结**

由题知，最优分配策略为：

- District 1: $2$ 名代表
- District 2: $1$ 名代表
- District 3: $2$ 名代表

公司的最大期望销售额（单位：million dollars）为：

$$
V_1(5) = 15.1
$$

### 附录

```bash
python3 main.py
```

可以检验结果的正确性：

```bash
V_3(0) = 3.3,    x_3^*(0) = 0
V_3(1) = 5.0,    x_3^*(1) = 1
V_3(2) = 6.3,    x_3^*(2) = 2
V_3(3) = 7.0,    x_3^*(3) = 3
V_3(4) = 7.0,    x_3^*(4) = 3
V_3(5) = 7.0,    x_3^*(5) = 3

V_2(0) = 6.2,    x_2^*(0) = 0
V_2(1) = 7.9,    x_2^*(1) = 0
V_2(2) = 9.6,    x_2^*(2) = 1
V_2(3) = 10.9,   x_2^*(3) = 1
V_2(4) = 11.6,   x_2^*(4) = 1
V_2(5) = 12.3,   x_2^*(5) = 2

V_1(0) = 8.1,    x_1^*(0) = 0
V_1(1) = 9.8,    x_1^*(1) = 0
V_1(2) = 11.5,   x_1^*(2) = 0
V_1(3) = 12.8,   x_1^*(3) = 0
V_1(4) = 14.1,   x_1^*(4) = 1
V_1(5) = 15.1,   x_1^*(5) = 2
```
